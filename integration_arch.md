# Интеграционные архитектурные паттерны

## Сообщения и коммуникации

### Паттерн: Message Queue (Очередь сообщений)

**Проблемы:**

-   **В повседневной жизни**: Представьте загруженный ресторан, где официанты передают заказы напрямую поварам. В час пик повара не успевают принимать заказы, официанты вынуждены ждать, создаётся хаос и задержки в обслуживании.
-   **В мире IT**: Необходимость обработать большое количество запросов без потери данных и перегрузки системы, особенно когда скорость отправки запросов может превышать скорость их обработки.

**Решение:**

-   **В повседневной жизни**: Внедрение системы талонов или очереди заказов, где официанты оставляют заказы в определённом месте, а повара берут их по одному, когда готовы к обработке. Никто никого не ждёт, процесс идёт плавно.
-   **В мире IT**: Создание промежуточного хранилища (очереди) для сообщений, где отправители помещают сообщения, а получатели забирают их, когда готовы обработать. Это обеспечивает асинхронную коммуникацию и предотвращает перегрузки.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Очередь заказов в ресторане
    -   Конвейер на производстве
    -   Система электронной очереди в банке
    -   Почтовые ящики для входящей корреспонденции
    -   Накопитель заданий для принтера
-   **В мире IT**:
    -   Обработка заказов в интернет-магазине
    -   Рассылка email-уведомлений
    -   Обработка загруженных файлов
    -   Система логирования событий
    -   Асинхронные задачи в веб-приложениях

### Паттерн: Publish/Subscribe (Публикация/подписка)

**Проблемы:**

-   **В повседневной жизни**: Представьте новостное агентство, которому нужно доставлять новости множеству подписчиков. Отправлять каждую новость индивидуально каждому читателю неэффективно, а некоторые читатели заинтересованы только в определённых темах.
-   **В мире IT**: Необходимость уведомлять множество компонентов системы о событиях, при этом позволяя компонентам подписываться только на интересующие их типы событий и избегая прямых зависимостей между компонентами.

**Решение:**

-   **В повседневной жизни**: Создание системы подписки, где читатели указывают интересующие их темы (спорт, политика, культура), а издательство автоматически доставляет соответствующие новости всем заинтересованным подписчикам.
-   **В мире IT**: Разделение отправителей (издателей) и получателей (подписчиков) сообщений, где издатели публикуют сообщения в определённые каналы, а подписчики получают только те сообщения из каналов, на которые они подписаны.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Подписка на журналы и газеты
    -   Рассылка новостей по email
    -   Оповещения о распродажах в магазинах
    -   Уведомления в социальных сетях
    -   Система оповещения о чрезвычайных ситуациях
-   **В мире IT**:
    -   Обновление пользовательского интерфейса
    -   Система уведомлений в приложении
    -   Мониторинг системных событий
    -   Обработка событий в реальном времени
    -   Интеграция микросервисов

### Паттерн: Event Bus (Шина событий)

**Проблемы:**

-   **В повседневной жизни**: Представьте большой офис, где сотрудники постоянно обмениваются информацией. Если каждый будет напрямую сообщать новости всем заинтересованным коллегам, возникнет хаос и часть информации может потеряться.
-   **В мире IT**: Необходимость организовать эффективный обмен событиями между множеством компонентов системы, избегая прямых связей между ними и обеспечивая надёжную доставку сообщений.

**Решение:**

-   **В повседневной жизни**: Создание централизованной системы оповещения в офисе, куда поступает вся важная информация и откуда она автоматически распространяется всем заинтересованным сотрудникам через определённые каналы коммуникации.
-   **В мире IT**: Внедрение централизованной шины событий, которая принимает события от источников и распределяет их между всеми заинтересованными получателями, обеспечивая надёжную доставку и маршрутизацию сообщений.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Система оповещения в торговом центре
    -   Корпоративная рассылка новостей
    -   Диспетчерская служба такси
    -   Координация работы аэропорта
    -   Управление железнодорожным движением
-   **В мире IT**:
    -   Интеграция корпоративных приложений
    -   Системы мониторинга и логирования
    -   Координация микросервисов
    -   Обработка IoT-данных
    -   Системы реального времени

### Паттерн: Request/Reply (Запрос/ответ)

**Проблемы:**

-   **В повседневной жизни**: Представьте ситуацию в ресторане, где клиент делает заказ и ждёт не только его выполнения, но и информации о статусе, времени ожидания и возможных изменениях. Нужен двусторонний диалог между клиентом и кухней.
-   **В мире IT**: Необходимость организовать двустороннюю коммуникацию между сервисами, где отправитель запроса ожидает получить ответ, и нужно правильно сопоставить запросы с соответствующими ответами.

**Решение:**

-   **В повседневной жизни**: Создание системы коммуникации, где каждый запрос получает уникальный номер, а ответ содержит ссылку на этот номер. Как в службе поддержки, где клиент получает номер обращения и может отслеживать его статус.
-   **В мире IT**: Реализация механизма, где каждому запросу присваивается уникальный идентификатор, а ответ содержит этот же идентификатор, что позволяет системе правильно сопоставлять запросы и ответы, даже если они обрабатываются асинхронно.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Система заказов в ресторане
    -   Служба поддержки клиентов
    -   Запрос документов в госучреждениях
    -   Заказ такси через приложение
    -   Бронирование билетов
-   **В мире IT**:
    -   Веб-сервисы и API
    -   Удалённые вызовы процедур
    -   Системы обмена сообщениями
    -   Микросервисная коммуникация
    -   Асинхронные запросы в приложениях

## Управление надежностью

### Паттерн: Circuit Breaker (Предохранитель)

**Проблемы:**

-   **В повседневной жизни**: Представьте электрическую сеть в доме без предохранителя. При перегрузке или коротком замыкании вся проводка может сгореть, создавая опасность пожара и дорогостоящий ремонт.
-   **В мире IT**: Необходимость защитить систему от каскадных сбоев, когда отказ одного сервиса может привести к перегрузке и отказу других сервисов, вызывая эффект домино.

**Решение:**

-   **В повседневной жизни**: Установка электрического предохранителя, который автоматически размыкает цепь при перегрузке, защищая всю систему. После устранения проблемы предохранитель можно включить снова.
-   **В мире IT**: Создание механизма, который отслеживает количество сбоев при вызовах сервиса и временно блокирует запросы при превышении порога ошибок, давая сервису время на восстановление и предотвращая перегрузку.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Электрические предохранители
    -   Тепловые выключатели в приборах
    -   Системы защиты двигателя
    -   Аварийные клапаны в трубопроводах
    -   Системы безопасности в лифтах
-   **В мире IT**:
    -   Защита микросервисов
    -   Обращения к внешним API
    -   Операции с базой данных
    -   Сетевые запросы
    -   Распределённые системы

### Паттерн: Retry Pattern (Повторная попытка)

**Проблемы:**

-   **В повседневной жизни**: Представьте ситуацию, когда вы звоните другу, но он не отвечает из-за временно плохой связи. Отказаться от звонка совсем было бы неправильно, ведь проблема может быть временной.
-   **В мире IT**: Необходимость корректно обрабатывать временные сбои в работе сервисов или сети, которые могут самоустраниться при повторной попытке, не прерывая работу всей системы.

**Решение:**

-   **В повседневной жизни**: Разработка стратегии повторных попыток: перезвонить через минуту, потом через пять минут, потом через час. Если после нескольких попыток связь не установлена, можно использовать альтернативный способ связи.
-   **В мире IT**: Реализация механизма автоматических повторных попыток с увеличивающимися интервалами между ними (exponential backoff) и ограничением максимального числа попыток.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Повторный набор номера телефона
    -   Попытки доставки почты
    -   Повторное отправление документов
    -   Попытки связаться с клиентом
    -   Повторные попытки входа в систему
-   **В мире IT**:
    -   HTTP-запросы к внешним сервисам
    -   Операции с базой данных
    -   Отправка сообщений в очередь
    -   Сетевые подключения
    -   Загрузка файлов

### Паттерн: Dead Letter Queue (Очередь "плохих" сообщений)

**Проблемы:**

-   **В повседневной жизни**: Представьте почтовое отделение, куда приходят письма с неправильными или несуществующими адресами. Выбрасывать такие письма нельзя, нужно иметь способ их обработки и возможного восстановления.
-   **В мире IT**: Необходимость корректно обрабатывать сообщения, которые не могут быть доставлены или обработаны по различным причинам, сохраняя их для анализа и возможной повторной обработки.

**Решение:**

-   **В повседневной жизни**: Создание специального отдела в почтовой службе для работы с недоставленными письмами, где пытаются выяснить правильный адрес, связаться с отправителем или найти получателя альтернативными способами.
-   **В мире IT**: Создание специальной очереди для сообщений, которые не удалось обработать, с механизмами для анализа причин сбоя, логирования и возможной повторной обработки после исправления проблем.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Обработка недоставленной почты
    -   Возврат неоплаченных банковских чеков
    -   Склад бракованной продукции
    -   Бюро находок
    -   Обработка неопознанных платежей
-   **В мире IT**:
    -   Системы обмена сообщениями
    -   Обработка электронных платежей
    -   Интеграция микросервисов
    -   Обработка событий в реальном времени
    -   Асинхронная обработка данных

## Управление взаимодействием сервисов

### Паттерн: API Gateway (Шлюз API)

**Проблемы:**

-   **В повседневной жизни**: Представьте большой торговый центр, где посетителям нужно взаимодействовать с разными магазинами, каждый со своими правилами и способами оплаты. Без единой точки входа это создаёт путаницу и неудобства.
-   **В мире IT**: Необходимость предоставить клиентам единую точку доступа к различным микросервисам, скрыв их сложность и разнородность, а также обеспечить безопасность, мониторинг и управление трафиком.

**Решение:**

-   **В повседневной жизни**: Создание единого входа в торговый центр с информационной стойкой, где посетители могут получить всю необходимую информацию, карту магазинов и единую карту лояльности для всех магазинов.
-   **В мире IT**: Внедрение промежуточного слоя между клиентами и сервисами, который обрабатывает все входящие запросы, маршрутизирует их к нужным сервисам, агрегирует ответы и предоставляет дополнительные функции (аутентификация, кэширование, мониторинг).

**Примеры применения:**

-   **В повседневной жизни**:
    -   Ресепшн в отеле
    -   Единый центр обслуживания клиентов
    -   Диспетчерская служба
    -   Справочное бюро аэропорта
    -   Центральный пункт охраны
-   **В мире IT**:
    -   Мобильные приложения
    -   Веб-порталы
    -   Публичные API
    -   Интеграционные платформы
    -   Облачные сервисы

### Паттерн: Backend for Frontend (BFF)

**Проблемы:**

-   **В повседневной жизни**: Представьте ресторан, где разные типы клиентов (посетители в зале, заказы на вынос, доставка) имеют разные потребности и способы взаимодействия. Использование одного и того же меню и процесса обслуживания для всех неэффективно.
-   **В мире IT**: Необходимость оптимизировать взаимодействие между различными клиентскими приложениями (веб, мобильные, десктоп) и бэкенд-сервисами, учитывая специфические требования каждого типа клиента.

**Решение:**

-   **В повседневной жизни**: Создание специализированных процессов обслуживания для каждого типа клиентов: отдельное меню и официанты для ресторана, специальная упаковка и процесс для заказов навынос, оптимизированная логистика для доставки.
-   **В мире IT**: Разработка отдельного бэкенд-сервиса для каждого типа клиентского приложения, который оптимизирует и агрегирует данные именно под нужды этого клиента.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Разные версии меню ресторана
    -   Специализированные отделы в магазине
    -   Разные форматы обучения в школе
    -   Персонализированное банковское обслуживание
    -   Индивидуальные туристические программы
-   **В мире IT**:
    -   Мобильные приложения
    -   Веб-приложения
    -   Десктопные приложения
    -   Smart TV приложения
    -   IoT устройства

### Паттерн: Service Registry (Реестр сервисов)

**Проблемы:**

-   **В повседневной жизни**: Представьте большой город без справочника служб и организаций. Жителям было бы сложно найти нужную службу, узнать её актуальный адрес и часы работы, особенно если организации часто переезжают или меняют график.
-   **В мире IT**: Необходимость отслеживать местоположение и состояние множества динамически меняющихся сервисов в распределённой системе, где сервисы могут появляться, исчезать или менять свои адреса.

**Решение:**

-   **В повседневной жизни**: Создание централизованного справочника всех служб города с актуальной информацией об их местонахождении, услугах и режиме работы, который постоянно обновляется.
-   **В мире IT**: Внедрение централизованного реестра, где сервисы регистрируются при запуске и регулярно обновляют информацию о своём состоянии. Другие сервисы обращаются к реестру для получения актуальной информации о доступных сервисах.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Телефонный справочник
    -   Каталог магазинов в торговом центре
    -   Справочник медицинских учреждений
    -   Реестр государственных услуг
    -   Список служб доставки
-   **В мире IT**:
    -   Облачные платформы
    -   Микросервисные архитектуры
    -   Контейнерные оркестраторы
    -   Системы балансировки нагрузки
    -   Сервисы обнаружения

### Паттерн: Load Balancer (Балансировщик нагрузки)

**Проблемы:**

-   **В повседневной жизни**: Представьте супермаркет с несколькими кассами, где все покупатели стоят в одной длинной очереди, в то время как некоторые кассы простаивают. Это создаёт задержки и неэффективное использование ресурсов.
-   **В мире IT**: Необходимость равномерно распределить нагрузку между несколькими серверами или сервисами, чтобы избежать перегрузки отдельных компонентов и обеспечить оптимальную производительность системы.

**Решение:**

-   **В повседневной жизни**: Внедрение системы управления очередями, где администратор или электронная система направляет покупателей к свободным кассам, обеспечивая равномерную загрузку всех касс и минимальное время ожидания.
-   **В мире IT**: Использование специального компонента (балансировщика), который распределяет входящие запросы между несколькими экземплярами сервиса по определённому алгоритму (round-robin, наименьшая нагрузка и т.д.).

**Примеры применения:**

-   **В повседневной жизни**:
    -   Распределение клиентов между кассами
    -   Назначение задач сотрудникам
    -   Распределение пациентов между врачами
    -   Управление потоками на дорогах
    -   Распределение студентов по группам
-   **В мире IT**:
    -   Веб-серверы
    -   Базы данных
    -   Микросервисы
    -   Облачные приложения
    -   Системы кэширования

## Управление бизнес-процессами и транзакциями

### Паттерн: Saga (Сага)

**Проблемы:**

-   **В повседневной жизни**: Представьте организацию свадьбы, где нужно скоординировать множество независимых поставщиков услуг (ресторан, фотограф, музыканты). Если один из них отказывается, нужно отменить или перепланировать все остальные услуги.
-   **В мире IT**: Необходимость управлять длительными бизнес-транзакциями, которые затрагивают несколько сервисов, и обеспечить согласованность данных даже при сбоях, когда классические ACID-транзакции невозможны.

**Решение:**

-   **В повседневной жизни**: Разбиение большого процесса на последовательность меньших шагов, где для каждого шага предусмотрен план отмены. Как в организации свадьбы: каждый договор с поставщиком включает условия отмены и возврата предоплаты.
-   **В мире IT**: Реализация распределённой транзакции как последовательности локальных транзакций, где каждая имеет компенсирующую операцию для отката изменений в случае сбоя на любом этапе.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Организация мероприятий
    -   Бронирование путешествий
    -   Процесс покупки недвижимости
    -   Оформление кредита
    -   Производственный процесс
-   **В мире IT**:
    -   Системы онлайн-бронирования
    -   Процессы оформления заказов
    -   Финансовые транзакции
    -   Системы доставки
    -   Микросервисные приложения

### Паттерн: Choreography vs Orchestration (Хореография и оркестрация)

**Проблемы:**

-   **В повседневной жизни**: Представьте два подхода к организации танцевального представления: в первом случае каждый танцор знает свою партию и реагирует на действия других (хореография), во втором - есть дирижёр, который управляет всеми движениями (оркестрация).
-   **В мире IT**: Необходимость координировать работу множества сервисов для выполнения сложного бизнес-процесса, выбирая между децентрализованным подходом, где сервисы самоорганизуются, и централизованным управлением.

**Решение:**

-   **В повседневной жизни**:
    -   Хореография: Каждый участник знает свою роль и реагирует на действия других, как в джазовой импровизации.
    -   Оркестрация: Центральный координатор (дирижёр) явно указывает каждому участнику, что и когда делать.
-   **В мире IT**:
    -   Хореография: Сервисы обмениваются событиями и реагируют на них автономно.
    -   Оркестрация: Центральный сервис управляет всем процессом и вызывает другие сервисы в нужном порядке.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Хореография:
        -   Уличное движение с правилами дорожного движения
        -   Работа рынка с самоорганизацией продавцов
        -   Флешмоб, где каждый знает свою роль
    -   Оркестрация:
        -   Симфонический оркестр с дирижёром
        -   Строительство под управлением прораба
        -   Съёмки фильма с режиссёром
-   **В мире IT**:
    -   Хореография:
        -   Системы, основанные на событиях
        -   Децентрализованные приложения
        -   Peer-to-peer системы
    -   Оркестрация:
        -   Рабочие процессы в BPM-системах
        -   Управление микросервисами
        -   Процессы развёртывания

### Паттерн: Transactional Outbox (Транзакционный аутбокс)

**Проблемы:**

-   **В повседневной жизни**: Представьте почтовое отделение, где письма нужно и зарегистрировать в журнале, и физически отправить. Если после регистрации что-то помешает отправке, возникнет несоответствие между записями и реальностью.
-   **В мире IT**: Необходимость надёжно отправлять сообщения или события в другие системы в рамках транзакции, обеспечивая согласованность данных даже при сбоях в процессе отправки.

**Решение:**

-   **В повседневной жизни**: Создание промежуточного хранилища (исходящего ящика), где письма сначала регистрируются и помещаются вместе с записью в журнале, а затем отдельный процесс занимается их фактической отправкой, отмечая успешные случаи.
-   **В мире IT**: Сохранение сообщений/событий в базу данных в рамках основной транзакции, а затем использование отдельного процесса для надёжной отправки этих сообщений в целевые системы.

**Примеры применения:**

-   **В повседневной жизни**:
    -   Обработка почтовых отправлений
    -   Система обработки заказов в ресторане
    -   Регистрация документов в канцелярии
    -   Обработка банковских платежей
    -   Система учёта складских операций
-   **В мире IT**:
    -   Системы обработки заказов
    -   Финансовые транзакции
    -   Системы уведомлений
    -   Интеграция микросервисов
    -   Системы аудита и логирования
