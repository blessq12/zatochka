---
description: Правила разработки, инструменты, команды и мониторинг
globs:
alwaysApply: true
---

# Правила разработки и инструменты

## Команды разработки

```bash
# Запуск в dev режиме
composer dev

# Анализ кода
composer analyse

# Тестирование
composer test

# Исправление стиля
composer fix
```

## Инструменты разработки

### Статический анализ

-   **PHPStan** - статический анализ (level 0)
-   **Psalm** - анализ типов
-   **PHP CS Fixer** - форматирование кода
-   **PHPUnit** - тестирование
-   **Laravel Debugbar** - отладка

### Конфигурация инструментов

-   `phpstan.neon` - конфигурация PHPStan
-   `psalm.xml` - конфигурация Psalm
-   `phpcs.xml` - конфигурация PHP CS Fixer
-   `phpunit.xml` - конфигурация PHPUnit

## Правила разработки

### 1. Код-стайл

-   PSR-12 стандарт
-   PHPStan level 0
-   Psalm для типизации
-   Автоформатирование через Pint

### 2. Безопасность

-   Роли и права через Spatie Permission
-   Middleware для защиты роутов
-   CSRF защита
-   Rate limiting для API

### 3. Производительность

-   Индексы в миграциях
-   Кэширование через Redis
-   Очереди для тяжелых операций
-   Eager loading связей

### 4. Тестирование

-   Unit тесты для сервисов
-   Feature тесты для API
-   Фабрики для тестовых данных
-   Моки для внешних сервисов

### 5. Dependency Injection

-   Привязка интерфейсов к реализациям в AppServiceProvider
-   Singleton для репозиториев и мапперов
-   Автоматическое внедрение зависимостей в Use Cases
-   Использование app() helper для получения сервисов

## Мониторинг и отладка

### Telescope

-   Запросы к БД
-   Очереди
-   События
-   Логи

### Debugbar

-   Профилирование запросов
-   Переменные
-   Время выполнения

### Логирование

-   Activity Log для действий пользователей (Spatie Activity Log)
-   Laravel Log для системных событий
-   Кастомные логи для бизнес-событий
-   FieldValueFormatterService для красивого отображения изменений в Activity Log

## Очереди

### Horizon

-   Мониторинг очередей
-   Управление воркерами
-   Статистика выполнения

### Фоновые задачи

-   Обработка бонусов
-   Отправка уведомлений
-   Генерация отчетов

## Конфигурация

### Основные конфигурации

-   `config/app.php` - основная конфигурация
-   `config/database.php` - база данных
-   `config/cache.php` - кэширование
-   `config/queue.php` - очереди
-   `config/horizon.php` - Horizon
-   `config/telescope.php` - Telescope

### Spatie конфигурации

-   `config/activitylog.php` - Activity Log
-   `config/permission.php` - Permission
-   `config/event-sourcing.php` - Event Sourcing
-   `config/media-library.php` - Media Library

## Развертывание

### Окружения

-   **Development** - локальная разработка
-   **Testing** - тестирование
-   **Production** - продакшн

### Миграции

-   Автоматический запуск миграций
-   Откат миграций при ошибках
-   Сидеры для начальных данных

### Кэширование

-   Кэширование конфигураций
-   Кэширование роутов
-   Кэширование представлений
-   Очистка кэша при деплое
