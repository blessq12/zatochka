---
description: Интеграции с внешними сервисами - Telegram, медиафайлы, API
globs:
alwaysApply: true
---

# Интеграции с внешними сервисами

## Telegram

### Уведомления

-   Уведомления через `laravel-notification-channels/telegram`
-   Модели `TelegramChat`, `TelegramMessage`
-   Автоматическая отправка уведомлений о статусах заказов

### Конфигурация

-   Настройка бота через переменные окружения
-   Обработка webhook'ов
-   Логирование сообщений

## Медиафайлы

### Spatie MediaLibrary

-   `spatie/laravel-medialibrary` для файлов
-   Привязка к заказам и другим сущностям
-   Таблица `media` для хранения метаданных файлов

### Типы медиафайлов

-   Фотографии заказов
-   Документы клиентов
-   Схемы и чертежи
-   Отчеты и справки

### Конфигурация

-   `config/media-library.php` - настройки медиабиблиотеки
-   Диск для хранения файлов
-   Обработка изображений
-   Сжатие и оптимизация

## Внешние API

### Платежные системы

-   Интеграция с платежными шлюзами
-   Обработка webhook'ов
-   Логирование транзакций

### СМС сервисы

-   Отправка SMS уведомлений
-   Проверка статуса доставки
-   Логирование сообщений

### Email сервисы

-   Отправка email уведомлений
-   Шаблоны писем
-   Очереди для массовой рассылки

## Конфигурация интеграций

### Переменные окружения

```env
# Telegram
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# Медиафайлы
FILESYSTEM_DISK=public
MEDIA_DISK=public

# API ключи
PAYMENT_API_KEY=
SMS_API_KEY=
EMAIL_API_KEY=
```

### Конфигурационные файлы

-   `config/services.php` - настройки внешних сервисов
-   `config/notifications.php` - настройки уведомлений
-   `config/queue.php` - настройки очередей для интеграций

## Обработка ошибок

### Retry механизмы

-   Повторные попытки при сбоях
-   Экспоненциальная задержка
-   Dead letter queue для неудачных сообщений

### Логирование

-   Логирование всех внешних запросов
-   Мониторинг статуса интеграций
-   Алерты при критических сбоях

## Безопасность

### API ключи

-   Безопасное хранение ключей
-   Ротация ключей
-   Ограничение доступа по IP

### Валидация данных

-   Проверка входящих данных
-   Санитизация данных
-   Защита от инъекций

## Мониторинг

### Метрики

-   Количество успешных/неудачных запросов
-   Время ответа внешних сервисов
-   Использование квот API

### Алерты

-   Уведомления о сбоях
-   Превышение лимитов
-   Критические ошибки
