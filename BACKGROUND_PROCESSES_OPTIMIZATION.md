# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞**

-   ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `app/Console/Kernel.php` –≤ `routes/console.php`
-   ‚úÖ –ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
-   ‚úÖ –õ–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–¥–∞—á**

#### **–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

-   `->withoutOverlapping()` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
-   `->timeout()` - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
-   `->onOneServer()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
-   `->runInBackground()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ

#### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

-   `->before()` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∑–∞–¥–∞—á–∏
-   `->after()` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤—Ä–µ–º–µ–Ω–∏**

-   ‚úÖ `bonuses:birthday` - 09:00
-   ‚úÖ `clients:birthday-greetings` - 09:15 (—Å–¥–≤–∏–Ω—É—Ç–æ –Ω–∞ 15 –º–∏–Ω—É—Ç)
-   ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫**

-   ‚úÖ `queue:check-n-restart` - –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (–±—ã–ª–æ 5)
-   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω timeout 2 –º–∏–Ω—É—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á

### **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**

```
08:00 - bonuses:expire (—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤)
09:00 - bonuses:birthday (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –∑–∞ –î–†)
09:15 - clients:birthday-greetings (–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å –î–†)
10:00 - bonuses:notify-expiring (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏)
12:00 - reviews:fetch (–ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ –∏–∑ API)
03:00 - backup:run (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
```

### **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:**

```
–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 10:00 - clients:revisit-reminders (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
–ü—è—Ç–Ω–∏—Ü–∞ 11:00 - orders:request-2gis-review (–∑–∞–ø—Ä–æ—Å –æ—Ç–∑—ã–≤–æ–≤)
```

### **–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:**

```
–ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ 02:00 - notifications:cleanup (–æ—á–∏—Å—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
```

### **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏:**

```
–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç - queue:check-n-restart (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π)
–ö–∞–∂–¥—ã–π —á–∞—Å - system:health-check (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ timeout

| –ó–∞–¥–∞—á–∞                       | Timeout  | –ü—Ä–∏—á–∏–Ω–∞               |
| ---------------------------- | -------- | --------------------- |
| `bonuses:*`                  | 5 –º–∏–Ω—É—Ç  | –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î |
| `clients:revisit-reminders`  | 10 –º–∏–Ω—É—Ç | –ú–∞—Å—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  |
| `orders:request-2gis-review` | 10 –º–∏–Ω—É—Ç | API –∑–∞–ø—Ä–æ—Å—ã           |
| `reviews:fetch`              | 15 –º–∏–Ω—É—Ç | –í–Ω–µ—à–Ω–∏–µ API           |
| `backup:run`                 | 30 –º–∏–Ω—É—Ç | –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `queue:check-n-restart`      | 2 –º–∏–Ω—É—Ç—ã | –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞      |
| `system:health-check`        | 1 –º–∏–Ω—É—Ç–∞ | –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞   |

## üè• –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

### **–ö–æ–º–∞–Ω–¥–∞:**

```bash
php artisan system:health-check
```

### **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**

-   ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
-   ‚úÖ –†–∞–±–æ—Ç–∞ –∫—ç—à–∞
-   ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π
-   ‚úÖ –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
-   ‚úÖ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

-   –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å
-   –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `storage/logs/laravel.log`
-   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üö® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supervisor**

```ini
[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/worker.log
stopwaitsecs=3600
```

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
* * * * * cd /path/to/project && php artisan schedule:run >> /dev/null 2>&1
```

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤**

```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
tail -f storage/logs/laravel.log | grep "Starting\|Completed\|Error"
```

### 4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**

```bash
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ulimit -n 65536
ulimit -u 2048
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**

```bash
# –ü–æ–∏—Å–∫ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep "queue:work\|schedule:run" | grep -v grep

# –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep "php" | wc -l
```

### **–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö queue workers
pkill -f "queue:work --daemon"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
pkill -f "schedule:run"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ supervisor
sudo supervisorctl restart all
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
tail -n 100 storage/logs/laravel.log | grep ERROR

# –õ–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
tail -n 50 storage/logs/laravel.log | grep "Starting\|Completed"
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

-   ‚ùå 20+ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ PHP
-   ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
-   ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
-   ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

-   ‚úÖ 2-4 –ø—Ä–æ—Ü–µ—Å—Å–∞ queue workers
-   ‚úÖ 1 –ø—Ä–æ—Ü–µ—Å—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
-   ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
-   ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
-   ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pkill -f "queue:work --daemon"
pkill -f "schedule:run"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
php artisan queue:work --daemon &
php artisan schedule:run &
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:**

```bash
# –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
php artisan system:health-check --verbose

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
php artisan schedule:list
```
