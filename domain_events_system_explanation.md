# üîÑ –°–∏—Å—Ç–µ–º–∞ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π: –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏—è](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-—Å–æ–±—ã—Ç–∏—è)
4. [–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤](#—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤)
5. [–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–ø–∏—Å–∫–∏](#–ø—Ä–æ—Ü–µ—Å—Å-–ø–æ–¥–ø–∏—Å–∫–∏)
6. [–ü—Ä–æ—Ü–µ—Å—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏](#–ø—Ä–æ—Ü–µ—Å—Å-–ø—É–±–ª–∏–∫–∞—Ü–∏–∏)
7. [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–∞–±–æ—Ç—ã)
8. [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã](#–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-—Å–∏—Å—Ç–µ–º—ã)

---

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### **–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –î–æ–º–µ–Ω–Ω—ã–π      ‚îÇ    ‚îÇ   EventBus      ‚îÇ    ‚îÇ   –°–ª—É—à–∞—Ç–µ–ª–∏     ‚îÇ
‚îÇ   —Å–µ—Ä–≤–∏—Å        ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (–®–∏–Ω–∞         ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (Subscribers) ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ   —Å–æ–±—ã—Ç–∏–π)      ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –°–æ–∑–¥–∞—ë—Ç       ‚îÇ    ‚îÇ   –•—Ä–∞–Ω–∏—Ç        ‚îÇ    ‚îÇ   –í—ã–ø–æ–ª–Ω—è—é—Ç     ‚îÇ
‚îÇ   —Å–æ–±—ã—Ç–∏–µ       ‚îÇ    ‚îÇ   –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤   ‚îÇ    ‚îÇ   –¥–µ–π—Å—Ç–≤–∏—è      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**

1. **–î–æ–º–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å** —Å–æ–∑–¥–∞—ë—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ
2. **EventBus** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
3. **–°–ª—É—à–∞—Ç–µ–ª–∏** –≤—ã–ø–æ–ª–Ω—è—é—Ç —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏–µ

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### **1. EventBusInterface (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å)**

```php
interface EventBusInterface
{
    public function publish(object $event): void;           // –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
    public function subscribe(string $eventClass, callable $handler): void;  // –ü–æ–¥–ø–∏—Å–∫–∞
    public function unsubscribe(string $eventClass, callable $handler): void; // –û—Ç–ø–∏—Å–∫–∞
    public function hasSubscribers(string $eventClass): bool;                 // –ü—Ä–æ–≤–µ—Ä–∫–∞
    public function getSubscribers(string $eventClass): array;                // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —à–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π

### **2. EventBus (–†–µ–∞–ª–∏–∑–∞—Ü–∏—è)**

```php
class EventBus implements EventBusInterface
{
    private array $subscribers = [];  // ‚Üê –í–û–¢ –ì–î–ï –•–†–ê–ù–Ø–¢–°–Ø –ü–û–î–ü–ò–°–ß–ò–ö–ò!

    // –ú–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —à–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π

### **3. DomainEvent (–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å)**

```php
abstract class DomainEvent
{
    public readonly DateTimeImmutable $occurredOn;  // –ö–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ—à–ª–æ
    public readonly string $eventId;                // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–±—ã—Ç–∏—è

    abstract public function eventName(): string;   // –ò–º—è —Å–æ–±—ã—Ç–∏—è
    abstract public function eventData(): array;    // –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### **4. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, UserRegistered)**

```php
class UserRegistered extends DomainEvent
{
    public function __construct(
        public readonly UserId $userId,
        public readonly string $name,
        public readonly Email $email
    ) {
        parent::__construct();  // –í—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞
    }
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏

### **5. –°–ª—É—à–∞—Ç–µ–ª–∏ (Subscribers)**

```php
class UserRegisteredSubscriber
{
    public function handle(UserRegistered $event): void
    {
        // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è
        Log::info('User registered', [...]);
        $this->sendWelcomeEmail($event);
    }
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏—è

### **–ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**

```
1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
   ‚Üì
2. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ EventBus
   ‚Üì
3. EventBus –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   ‚Üì
4. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è
   ‚Üì
5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ‚Üì
6. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

---

## üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

### **–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏?**

```php
class EventBus implements EventBusInterface
{
    private array $subscribers = [];  // ‚Üê –í–û–¢ –û–ù–û!
}
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**

```php
$subscribers = [
    // –ö–ª–∞—Å—Å —Å–æ–±—ã—Ç–∏—è ‚Üí –º–∞—Å—Å–∏–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    'App\Domain\Users\Events\UserRegistered' => [
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 1: –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞
        [UserRegisteredSubscriber, 'handle'],

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 2: –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function(UserRegistered $event) { ... },

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 3: –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥
        [AnotherSubscriber, 'processUserRegistration']
    ],

    'App\Domain\Users\Events\UserActivated' => [
        [UserActivatedSubscriber, 'handle'],
        [NotificationSubscriber, 'sendActivationEmail']
    ]
];
```

### **–¢–∏–ø—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**

1. **–ú–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–æ–≤:** `[ClassName, 'methodName']`
2. **–ê–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** `function($event) { ... }`
3. **–ó–∞–º—ã–∫–∞–Ω–∏—è:** `fn($event) => ...`

---

## üìù –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–ø–∏—Å–∫–∏

### **–ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥–ø–∏—Å–∫–∞:**

#### **1. –í –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ (EventsDomainServiceProvider):**

```php
public function boot(): void
{
    $this->registerDomainEventListeners();
}

private function registerDomainEventListeners(): void
{
    $eventBus = $this->app->make(EventBusInterface::class);
    $userRegisteredSubscriber = $this->app->make(UserRegisteredSubscriber::class);

    // –ü–û–î–ü–ò–°–ö–ê: –≥–æ–≤–æ—Ä–∏–º EventBus'—É —Å–ª—É—à–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ UserRegistered
    $eventBus->subscribe(
        UserRegistered::class,                    // ‚Üê –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
        [$userRegisteredSubscriber, 'handle']     // ‚Üê –û–±—Ä–∞–±–æ—Ç—á–∏–∫
    );
}
```

#### **2. –í EventBus::subscribe():**

```php
public function subscribe(string $eventClass, callable $handler): void
{
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –º–∞—Å—Å–∏–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
    if (!isset($this->subscribers[$eventClass])) {
        $this->subscribers[$eventClass] = [];  // –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
    }

    // 2. –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –º–∞—Å—Å–∏–≤
    $this->subscribers[$eventClass][] = $handler;

    // 3. –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É
    Log::debug('Event handler subscribed', [
        'event' => $eventClass,
        'handler' => is_array($handler) ? get_class($handler[0]) . '::' . $handler[1] : 'closure',
        'total_subscribers' => count($this->subscribers[$eventClass])
    ]);
}
```

#### **3. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏:**

```php
// –î–æ –ø–æ–¥–ø–∏—Å–∫–∏:
$subscribers = [];

// –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏:
$subscribers = [
    'App\Domain\Users\Events\UserRegistered' => [
        [UserRegisteredSubscriber, 'handle']
    ]
];
```

---

## üì¢ –ü—Ä–æ—Ü–µ—Å—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### **–ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è:**

#### **1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –¥–æ–º–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ:**

```php
// –í UserDomainService::register()
$user = User::register($userId, $name, $emailVO, $passwordHash);

// ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ...

// –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø –°–û–ë–´–¢–ò–Ø
$this->events->publish(new UserRegistered($user->userId(), $user->name(), $user->email()));
```

#### **2. –í—ã–∑–æ–≤ EventBus::publish():**

```php
public function publish(object $event): void
{
    try {
        // 1. –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å —Å–æ–±—ã—Ç–∏—è
        $eventClass = get_class($event);

        // 2. –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        Log::debug('Publishing domain event', [
            'event' => $eventClass,
            'timestamp' => now()->toISOString()
        ]);

        // 3. –ò—â–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ —ç—Ç–æ—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
        if (isset($this->subscribers[$eventClass])) {
            // 4. –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
            foreach ($this->subscribers[$eventClass] as $handler) {
                try {
                    $handler($event);  // ‚Üê –í–´–ó–´–í–ê–ï–ú –û–ë–†–ê–ë–û–¢–ß–ò–ö!

                    Log::debug('Event handler executed successfully', [...]);
                } catch (\Exception $e) {
                    Log::error('Event handler failed', [...]);
                    continue;  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –¥—Ä—É–≥–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
                }
            }
        }

        // 5. –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        Log::debug('Event published successfully', [
            'event' => $eventClass,
            'subscribers_count' => isset($this->subscribers[$eventClass]) ? count($this->subscribers[$eventClass]) : 0
        ]);
    } catch (\Exception $e) {
        Log::error('Failed to publish event', [...]);
        throw $e;
    }
}
```

#### **3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**

```php
// EventBus –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:
$handlers = $this->subscribers['App\Domain\Users\Events\UserRegistered'];

// –ò –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–∞–∂–¥–æ–≥–æ:
foreach ($handlers as $handler) {
    $handler($event);  // –í—ã–∑—ã–≤–∞–µ—Ç UserRegisteredSubscriber::handle($event)
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### **–ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

#### **–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è**

```php
// –í UserDomainService
$event = new UserRegistered($userId, $name, $email);
// –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ —Å:
// - eventId = "event_64f8a1b2c3d4e5f6"
// - occurredOn = "2024-01-15T10:30:00+00:00"
```

#### **–®–∞–≥ 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è**

```php
$this->eventBus->publish($event);
// EventBus –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —Ç–∏–ø–∞ UserRegistered
```

#### **–®–∞–≥ 3: –ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤**

```php
// EventBus –∏—â–µ—Ç –≤ $subscribers:
$eventClass = 'App\Domain\Users\Events\UserRegistered';
$handlers = $this->subscribers[$eventClass] ?? [];
// –ù–∞—Ö–æ–¥–∏—Ç: [UserRegisteredSubscriber, 'handle']
```

#### **–®–∞–≥ 4: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**

```php
// –í—ã–∑—ã–≤–∞–µ—Ç UserRegisteredSubscriber::handle($event)
foreach ($handlers as $handler) {
    $handler($event);
}
```

#### **–®–∞–≥ 5: –†–µ–∑—É–ª—å—Ç–∞—Ç**

-   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
-   –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
-   –ó–∞–ø–∏—Å–∞–Ω–æ –≤ –ª–æ–≥
-   –°–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ

### **–ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è**

#### **–î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:**

```php
// –í EventsDomainServiceProvider
$adminNotifier = $this->app->make(AdminNotifierSubscriber::class);

$eventBus->subscribe(
    UserRegistered::class,
    [$adminNotifier, 'notifyAdmin']
);

// –¢–µ–ø–µ—Ä—å $subscribers –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
$subscribers = [
    'App\Domain\Users\Events\UserRegistered' => [
        [UserRegisteredSubscriber, 'handle'],        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        [AdminNotifierSubscriber, 'notifyAdmin']     // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
    ]
];
```

#### **–ü—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è UserRegistered:**

1. –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è `UserRegisteredSubscriber::handle()`
2. –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è `AdminNotifierSubscriber::notifyAdmin()`
3. –û–±–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ–ª—É—á–∞—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–±—ã—Ç–∏–µ

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

### **1. –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å**

```php
// UserDomainService –ù–ï –∑–Ω–∞–µ—Ç –æ —Å–ª—É—à–∞—Ç–µ–ª—è—Ö
$this->events->publish(new UserRegistered(...));

// EventBus –ù–ï –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö
$handler($event);  // –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
```

### **2. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**

```php
// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ - –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
$eventBus->subscribe(UserRegistered::class, [NewSubscriber, 'handle']);

// –ù–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ!
```

### **3. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**

```php
// –í —Ç–µ—Å—Ç–∞—Ö –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç—å EventBus
$mockEventBus = Mockery::mock(EventBusInterface::class);
$mockEventBus->shouldReceive('publish')->once();

// –ò–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π EventBus –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
$eventBus = new EventBus();
$eventBus->subscribe(UserRegistered::class, $testHandler);
```

### **4. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞**

```php
// EventBus —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Laravel
$eventBus = new EventBus();
$eventBus->subscribe(UserRegistered::class, $handler);
$eventBus->publish($event);

// –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ CLI, API, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

```php
// EventBus –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
Log::debug('Publishing domain event', [...]);
Log::debug('Event handler executed successfully', [...]);
Log::debug('Event published successfully', [...]);
```

### **2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**

```php
// –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞—Ö
$hasSubscribers = $eventBus->hasSubscribers(UserRegistered::class);
$subscribers = $eventBus->getSubscribers(UserRegistered::class);
$stats = $eventBus->getEventStats();
```

### **3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

```php
// –ï—Å–ª–∏ –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–ø–∞–ª, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
try {
    $handler($event);
} catch (\Exception $e) {
    Log::error('Event handler failed', [...]);
    continue;  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –¥—Ä—É–≥–∏–º–∏
}
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### **1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π**

```php
// –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
class UserActivated extends DomainEvent
{
    public function __construct(public readonly UserId $userId)
    {
        parent::__construct();
    }

    public function eventName(): string { return 'UserActivated'; }
    public function eventData(): array { return ['user_id' => (string) $this->userId]; }
}

// –°–æ–∑–¥–∞—ë–º —Å–ª—É—à–∞—Ç–µ–ª—å
class UserActivatedSubscriber
{
    public function handle(UserActivated $event): void
    {
        // –õ–æ–≥–∏–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
    }
}

// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
$eventBus->subscribe(UserActivated::class, [UserActivatedSubscriber::class, 'handle']);
```

### **2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**

```php
// –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
class AsyncEventBus implements EventBusInterface
{
    public function publish(object $event): void
    {
        // –í–º–µ—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
        // dispatch(new ProcessEventJob($event));
    }
}
```

### **3. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π**

```php
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –±–∞–∑—É –¥–ª—è –∞—É–¥–∏—Ç–∞
class PersistentEventBus implements EventBusInterface
{
    public function publish(object $event): void
    {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏–µ
        $this->eventRepository->save($event);

        // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
        $this->notifySubscribers($event);
    }
}
```

---

## üìö –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### **1. "Tell, Don't Ask"**

-   –î–æ–º–µ–Ω **–≥–æ–≤–æ—Ä–∏—Ç** –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
-   EventBus **—Ä–µ—à–∞–µ—Ç**, –∫—Ç–æ –¥–æ–ª–∂–µ–Ω –æ–± —ç—Ç–æ–º —É–∑–Ω–∞—Ç—å
-   –°–ª—É—à–∞—Ç–µ–ª–∏ **–¥–µ–π—Å—Ç–≤—É—é—Ç** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—ã—Ç–∏—è

### **2. –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å**

-   –ò–∑–¥–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏—è –Ω–µ –∑–Ω–∞–µ—Ç –æ —Å–ª—É—à–∞—Ç–µ–ª—è—Ö
-   –°–ª—É—à–∞—Ç–µ–ª–∏ –Ω–µ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ
-   EventBus –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

### **3. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**

-   EventBus –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Å–æ–±—ã—Ç–∏—è
-   –°–æ–±—ã—Ç–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ
-   –°–ª—É—à–∞—Ç–µ–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏

---

_–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–∞—ë—Ç –≤–∞–º –º–æ—â–Ω—ã–π, –Ω–æ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –¥–æ–º–µ–Ω–∞ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –∂—ë—Å—Ç–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π._ üéâ
